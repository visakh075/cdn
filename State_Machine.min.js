function Socket_Init(){console.log("Initilising Socket."),Socket=new WebSocket("ws://"+window.location.hostname+":1102/"),console.log("Initilising Socket Completed."),Socket.onmessage=function(e){console.log("Incoming from Server------>");for(var t=0;t<Machine.Dwld_Page.blocks_per_page;t++)for(var s=hs2iA(e.data.slice(32*t,32*(t+1))),o=0;o<4;o++)for(var _=0;_<4;_++)Machine.Dwld_Page.Blocks[t].byte[_][o]=s[4*o+_];var a=$("#rxConsole").val();$("#rxConsole").val(a+Machine.Dwld_Page.getBlocks()),Machine.Next()},Socket.onclose=function(e){console.log("Disconnected by Server"),window.close()}}class Page{constructor(){this.blocks_per_page=5,this.header_per_page=1,this.Blocks=new Array;for(var e=0;e<this.blocks_per_page;e++)this.Blocks[e]=new DataBlock}randomize(){for(var e=0;e<this.blocks_per_page;e++)for(var t=0;t<4;t++)for(var s=0;s<4;s++)this.Blocks[e].byte[t][s]=256*Math.random()}clear(){for(var e=this.header_per_page;e<this.blocks_per_page;e++)for(var t=0;t<4;t++)for(var s=0;s<4;s++)this.Blocks[e].byte[t][s]=0}encrypt(e){for(var t=this.header_per_page;t<this.blocks_per_page;t++)this.Blocks[t].encrypt(e)}decrypt(e){for(var t=this.header_per_page;t<this.blocks_per_page;t++)this.Blocks[t].decrypt(e)}Show(){for(var e=0;e<this.blocks_per_page;e++){for(var t="",s=0;s<4;s++)for(var o=0;o<4;o++)t+=i2h(this.Blocks[e].byte[o][s]);console.log(t)}}getBlocks(){for(var e="",t=0;t<this.blocks_per_page;t++)e+=this.Blocks[t].getBlock_hs();return e}copy(e){for(var t=0;t<this.blocks_per_page;t++)for(var s=0;s<4;s++)for(var o=0;o<4;o++)this.Blocks[t].byte[s][o]=e.Blocks[t].byte[s][o]}}class State_Machine{constructor(){this.Init(),this.Next()}in_Status_Update(){this.n_State_SRV=this.Dwld_Page.Blocks[0].byte[0][0],this.n_State_CLT=this.Dwld_Page.Blocks[0].byte[1][0],this.n_Comnd=this.Dwld_Page.Blocks[0].byte[2][0],this.n_Reqst=this.Dwld_Page.Blocks[0].byte[3][0]}Init(){this.n_State_SRV=STATES_SRV.SRV_STRT,this.n_State_CLT=STATES_CLT.CLT_STRT,this.n_Reqst=REQS.STRT_SRV,this.n_Comnd=CMDS.SRV_HOLD,this.Dwld_Page=new Page,this.sign=!1,this.Upld_Page=new Page,this.Signature=new DataBlock,this.Current_State=new DataBlock,this.Dwld_Page.Blocks[0].byte[0][0]=this.n_State_SRV,this.Dwld_Page.Blocks[0].byte[1][0]=this.n_State_CLT,this.Dwld_Page.Blocks[0].byte[2][0]=this.n_Comnd,this.Dwld_Page.Blocks[0].byte[3][0]=this.n_Reqst,this.Next()}Show_Header(){console.log("State_SRV : "+v_STATES_SRV(this.Dwld_Page.Blocks[0].byte[0][0])),console.log("State_CLT : "+v_STATES_CLT(this.Dwld_Page.Blocks[0].byte[1][0])),console.log("Reqst : "+v_REQS(this.Dwld_Page.Blocks[0].byte[3][0])),console.log("Comnd : "+v_CMDS(this.Dwld_Page.Blocks[0].byte[2][0])),console.log("Sign_Attempts :"+this.Dwld_Page.Blocks[0].byte[0][1]),console.log("Users :"+this.Dwld_Page.Blocks[0].byte[2][1]),console.log("User Id :"+this.Dwld_Page.Blocks[0].byte[3][1])}Next(){switch(console.log("Download Page Header"),this.Show_Header(),this.n_State_CLT==this.Dwld_Page.Blocks[0].byte[1][0]?console.log("State_Consistent"):console.log("State_IN_Consistent"),this.in_Status_Update(),this.n_State_CLT){case STATES_CLT.CLT_STRT:this.Dwld_Page.Blocks[0].byte[1][0]=STATES_CLT.CLT_INIT,this.n_State_CLT=STATES_CLT.CLT_INIT;break;case STATES_CLT.CLT_INIT:this.n_State_CLT=STATES_CLT.CLT_HDSS,Socket_Init();break;case STATES_CLT.CLT_HDSS:this.n_Comnd==CMDS.CLT_CONN_ACK&&(Machine.Signature.copy(Machine.Dwld_Page.Blocks[2]),genLogin_form()),this.n_Comnd==CMDS.CLT_HDSS_ACK&&(this.sign=!0,this.n_State_CLT=STATES_CLT.CLT_AUTH,this.Upld_Page.clear(),this.Upld_Page.Blocks[0].byte[0][0]=this.n_State_SRV,this.Upld_Page.Blocks[0].byte[1][0]=this.n_State_CLT,this.Upld_Page.Blocks[0].byte[2][0]=this.n_Comnd,this.Upld_Page.Blocks[0].byte[3][0]=REQS.CLT_DTA_RQST,this.Send_Page(),this.Current_State=new DataBlock);break;case STATES_CLT.CLT_AUTH:this.n_Comnd==CMDS.CLT_HDSS_ACK&&this.sign,this.n_Comnd!=CMDS.SRV_DTA_RESP&&this.n_Comnd!=CMDS.SRV_DTA_COMM||!0!==this.sign||(this.Current_State.copy(this.Dwld_Page.Blocks[1]),console.log("Recived Current :"+this.Current_State.getBlock()),this.Current_State.decrypt(this.K_SYM),console.log("Recived Current :"+this.Current_State.getBlock()),genConsole_form())}}Send_Page(){Socket.send(this.Upld_Page.getBlocks())}}