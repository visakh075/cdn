function random_color(){var color;return new Array(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()))}class tag{constructor(type,content,attr,_class){this.list=new Array;var m_content=new Array;"string"==typeof content?m_content.push(content):content instanceof Array&&(m_content=content),this.list.push(type,m_content,attr,_class)}extract(){var tag_impl="",type=this.list[0],inter="";tag_impl+="<"+type,void 0!==this.list[2]&&""!=this.list[2]&&(tag_impl+=" "+this.list[2]),void 0!==this.list[3]&&(tag_impl+=" class='"+this.list[3]+"'"),tag_impl+=">";for(var i=0;i<this.list[1].length;i++){var element=this.list[1][i];"string"==typeof element?inter+=element:element instanceof tag&&(inter+=element.extract())}return tag_impl+=inter,tag_impl+="</"+type+">"}add(content){"string"==typeof content?this.list[1].push(content):content instanceof tag&&this.list[1].push(content)}add_tag(type,content,attr,_class){this.add(new tag(type,content,attr,_class))}div(content){var child=new tag("div",content);this.add(child)}p(content){var child=new tag("p",content);this.add(child)}}function format(){var p_w=$(".Box").width();$(".Box").children().each((function(){$(this).width(p_w/2-10),$(this).height(p_w/2-10)}));var p_w=$(".Box-login").width();$(".Box-login").children().each((function(){$(this).width(p_w-10)})),$("#form-submit").height(p_w/2-10),$("formTX").attr("maxlength",16*(Machine.Dwld_Page.blocks_per_page-Machine.Dwld_Page.header_per_page)),$(window).scrollTop(scroll)}function Add_Slot(Box,Content){var slot=new tag("div","","","Slot");return slot.add(Content),Box.add(slot),Box}function genConsole_form(){for(var Uis=new Array,i=0;i<4;i++){var cap=255==Machine.Current_State.byte[i][0]?"On":"Off";Uis.push(new tag("input","","id='sw"+i+"' value='"+cap+"' type='button'","form-bttn sw_bttn c"+i))}var Status_Slot=new tag("div","","","c2");Status_Slot.div("S_SRV : "+v_STATES_SRV(Machine.n_State_SRV)),Status_Slot.div("S_CLT : "+v_STATES_CLT(Machine.n_State_CLT)),Status_Slot.div("COMND : "+v_CMDS(Machine.n_Comnd)),Status_Slot.div("REQST : "+v_REQS(Machine.n_Reqst)),Status_Slot.div("SIGN_ : "+Machine.Dwld_Page.Blocks[0].byte[0][1]),Status_Slot.div("COMM_ : "+Machine.Dwld_Page.Blocks[0].byte[1][1]),Status_Slot.div("C_CNT : "+Machine.Dwld_Page.Blocks[0].byte[2][1]),Status_Slot.div("U_ID_ : "+Machine.Dwld_Page.Blocks[0].byte[3][1]);var Logout_Button=new tag("input","","id='form-logout' value='LogOut' type='button'","form-bttn c0"),Dwnld_Slot=new tag("div","","","c1 c_Dwn");Dwnld_Slot.div(Machine.Dwld_Page.getBlocks());var SendTxt=new tag("textarea","","id='form-send' no","c_Dwn c3_x"),SendBtn=new tag("input","","type='button' id='formTX' value='Send'","c3"),Box=new tag("div","","","Box");for(Ui in Uis)Box=Add_Slot(Box,Uis[Ui]);Box=Add_Slot(Box,Dwnld_Slot),Box=Add_Slot(Box,Status_Slot),Box=Add_Slot(Box,SendTxt),Box=Add_Slot(Box,SendBtn),Box=Add_Slot(Box,Logout_Button),$("body").html(Box.extract()),format(),$(".sw_bttn").click((function(){var id=$(this).attr("id"),idx=parseInt(id.substr(id.length-1,1));0==Machine.Current_State.byte[idx][0]?(Machine.Current_State.byte[idx][0]=255,$(this).val("On"),$(this).val(Machine.Current_State.byte[idx][0])):(Machine.Current_State.byte[idx][0]=0,$(this).val("Off"),$(this).val(Machine.Current_State.byte[idx][0])),Machine.Upld_Page.clear(),Machine.Upld_Page.Blocks[1].copy(Machine.Current_State),Machine.Upld_Page.encrypt(Machine.K_SYM),Machine.Upld_Page.Blocks[0].byte[0][0]=Machine.n_State_SRV,Machine.Upld_Page.Blocks[0].byte[1][0]=Machine.n_State_CLT,Machine.Upld_Page.Blocks[0].byte[2][0]=Machine.n_Comnd,Machine.Upld_Page.Blocks[0].byte[3][0]=REQS.CLT_DTA_COMM,Machine.Send_Page(),Machine.in_Status_Update()})),$("#form-logout").click((function(){Machine.Upld_Page.Blocks[0].byte[0][0]=Machine.n_State_SRV,Machine.Upld_Page.Blocks[0].byte[1][0]=Machine.n_State_CLT,Machine.Upld_Page.Blocks[0].byte[2][0]=Machine.n_Comnd,Machine.Upld_Page.Blocks[0].byte[3][0]=REQS.CLT_AUTH_CLS,Machine.Upld_Page.encrypt(Machine.K_SYM),Machine.Send_Page(),this.Signature=new DataBlock,Machine=new State_Machine,Machine.Next()})),$("#formTX").click((function(){var Data=new DataBank($("#form-send").val());Machine.Dwld_Page.clear(),Machine.Dwld_Page.Blocks[0].byte[3][0]=REQS.CLT_DTA_COMM,Machine.Dwld_Page.Blocks[1].copy(Machine.Current_State);for(var i=0;i<Data.numBlocks;i++)Machine.Dwld_Page.Blocks[2+i].copy(Data.DataBlocks[i]);Machine.Upld_Page.copy(Machine.Dwld_Page),Machine.Upld_Page.encrypt(Machine.K_SYM),Machine.Send_Page()})),format()}function genLogin_form(){var form=new tag("form","","id='form-login'"),Box=new tag("div","","","Box");Box=Add_Slot(Box,new tag("input","","id='form-user-name' type='text' maxlength=16","c1_x")),Box=Add_Slot(Box,new tag("input","","id='form-password' type='password' maxlength=16","c2_x")),Box=Add_Slot(Box,new tag("input","","id='form-submit' type='submit' value='LogIn'","c0")),form.add(Box),$("body").html(form.extract()),$("#form-login").submit((function(event){event.preventDefault();var sign_str=format_str($("#form-user-name").val())+format_str($("#form-password").val());console.log(sign_str),Machine.K_SYM=new KeyBank(sign_str),Machine.Dwld_Page.Blocks[2].copy(Machine.Signature),Machine.Dwld_Page.decrypt(Machine.K_SYM),Machine.Upld_Page.copy(Machine.Dwld_Page),Machine.Upld_Page.Blocks[0].byte[0][0]=STATES_SRV.SRV_INIT,Machine.Upld_Page.Blocks[0].byte[1][0]=STATES_CLT.CLT_HDSS,Machine.Upld_Page.Blocks[0].byte[2][0]=CMDS.CLT_CONN_ACK,Machine.Upld_Page.Blocks[0].byte[3][0]=REQS.CLT_HDSS_REQ,Machine.Send_Page()})),format()}function genPref_form(){var form=new tag("form","","id='Compund-form'"),Box=new tag("div","","","Box");Box=Add_Slot(Box,new tag("input","","id='form-user-name' type='text' maxlength=16","c1_x")),Box=Add_Slot(Box,new tag("input","","id='form-password' type='password' maxlength=16","c2_x"))}